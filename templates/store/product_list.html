{% extends 'admin-temp/base.html' %}
{% load static %}
{% block content %}


<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Products List</h2>
            <p>Your Product List is Here...!</p>
        </div>
        <div>
            <a href="{% url 'add_product' %}" class="btn btn-primary btn-sm rounded">Create new</a>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-body">
            <div class="table-responsive" id='pro-tab-body'>
                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

                <table class="table table-hover" id="productPagination">
                    <thead>
                        <tr>
                            <th style="width: 50px ;" class="text-center">Image</th>
                            <th style="width: 200px;" class="text-center">Name</th>                          
                            <th style="width: 100px;" class="text-center">Price</th>
                            <th  style="width: 200px;" class="text-center">Action</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        {% for Product in products %}
                        <tr>  
                            <td style="vertical-align: middle; height:100px" class="text-center">
                                <a href="{{ Product.get_url }}" class="img-wrap"> 
                                    <img src="{{ Product.images.url }}" alt="Product"> 
                                </a>
                            </td>
                            <td style="vertical-align: middle;" class="text-center">
                                <a href="#" class="text-truncate">{{ Product.product_name }}</a>
                            </td>
                            
                            <td style="vertical-align: middle;" class="text-center">â‚¹ {{ Product.price }}</td>
                            <td style="vertical-align: middle;" class="text-center">
                                <a href="{% url 'update_product' Product.id %}" class="btn btn-sm font-sm rounded btn-brand">
                                    <i class="material-icons md-edit"></i> Edit
                                </a>
                                <a  id='del-product' data-product-id="{{Product.id}}" class="btn btn-sm font-sm btn-light rounded">
                                    <i class="material-icons md-delete_forever"></i> Delete
                                </a>
                                {% if Product.is_available %}
                                    <a class="btn btn-sm font-sm btn-outline-warning rounded" id='deact-product' data-product-id="{{Product.id}}">Deactivate</a>
                                {% else %}
                                    <a class="btn btn-sm font-sm btn-outline-primary rounded" id='deact-product' data-product-id="{{Product.id}}">Activate</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div> <!-- table-responsive end// -->
        </div> <!-- card-body end// -->
         <!-- card-body end// -->
    </div> <!-- card end// -->
</section> <!-- content-main end// -->
{% endblock %}
{% block script %}
<script>
    $('#productPagination').DataTable({
        paging:true,
        pageLength:5,
        lengthChange:true,
        autoWidth:true,
        searching:true,
        bInfo:true,
        bSort:false,
    })
</script>
<script>
    $(document).on('click', '#del-product', function(){
        var product_id = $(this).data('product-id')
        var csrfToken = $('input[name="csrfmiddlewaretoken"]').val()
    
        swal({
            title: "Are You sure",
            text:"Do you want to delete this Product???",
            icon:"warning",
            buttons: ["cancel", "Delete"],
            dangerMode: true,
        }).then(function(confirmDelete){
            if (confirmDelete) {
                $.ajax({
                    url:"/admin_cu/del_product/" + product_id + "/",
                    method:"POST",
                    data:{
                        'product_id':product_id,
                        'csrfmiddlewaretoken':csrfToken,
                    },
                    success:function(response){
                        swal({
                            title:"Deleted",
                            text:response.message,
                            icon:"success",
                            timer:4000,
                            button:false,
                        }).then(function() {
                            $("#pro-tab-body").load(location.href + ' #pro-tab-body');
                            
                        });
                    } 
                })
            }
        });
    
        
        
    });
</script>

 
<script>
    

    $(document).on('click', '#deact-product', function(){
        var product_id = $(this).data('product-id');
        var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
        var text = $(this).text();
    
        swal({
            title: "Are You sure",
            text: 'Do you want to '+ text +' this Product???',
            icon: "warning",
            buttons: ["cancel", "Confirm"],
            dangerMode: true,
        }).then(function(confirmConfirm){
            if (confirmConfirm) {
                $.ajax({
                    url: "/admin_cu/deact_product/",
                    method: "POST",
                    data: {
                        'product_id': product_id,
                        'csrfmiddlewaretoken': csrfToken,
                    },
                    success: function(response) {
                        swal({
                            title: response.title,
                            text: response.message,
                            icon: "success",
                            timer: 4000,
                            button: false,
                            
                        }).then(function() {
                            // Reload the specified area
                            $("#pro-tab-body").load(location.href + ' #pro-tab-body');
                            
                        });
                    }
                });
            }
        });
    });
    
</script>
{% endblock script %}
